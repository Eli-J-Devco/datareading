<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ModelSmaStp2550us50">
	<resultMap id="ModelSmaStp2550us50Map" type="com.nwm.api.entities.ModelSmaStp2550us50Entity">
			<result property="time" column="time" />
			<result property="id_device" column="id_device" />
			<result property="error" column="error" />
			<result property="low_alarm" column="low_alarm" />
			<result property="high_alarm" column="high_alarm" />
			
			<result property="Grid_Frequency" column="Grid_Frequency" />
			<result property="Apparent_Power" column="Apparent_Power" />
			<result property="Reactive_Power" column="Reactive_Power" />
			<result property="Active_Power" column="Active_Power" />
			<result property="Power_Factor" column="Power_Factor" />
			<result property="Grid_Current" column="Grid_Current" />
			<result property="Current_Phase_1" column="Current_Phase_1" />
			<result property="Current_Phase_2" column="Current_Phase_2" />
			<result property="Current_Phase_3" column="Current_Phase_3" />
			<result property="Active_Power_Phase_1" column="Active_Power_Phase_1" />
			<result property="Active_Power_Phase_2" column="Active_Power_Phase_2" />
			<result property="Active_Power_Phase_3" column="Active_Power_Phase_3" />
			<result property="Reactive_Power_Phase_1" column="Reactive_Power_Phase_1" />
			<result property="Reactive_Power_Phase_2" column="Reactive_Power_Phase_2" />
			<result property="Reactive_Power_Phase_3" column="Reactive_Power_Phase_3" />
			<result property="Apparent_Power_Phase_1" column="Apparent_Power_Phase_1" />
			<result property="Apparent_Power_Phase_2" column="Apparent_Power_Phase_2" />
			<result property="Apparent_Power_Phase_3" column="Apparent_Power_Phase_3" />
			<result property="Voltage_Phase_1" column="Voltage_Phase_1" />
			<result property="Voltage_Phase_2" column="Voltage_Phase_2" />
			<result property="Voltage_Phase_3" column="Voltage_Phase_3" />
			<result property="Voltage_Phase_1_2" column="Voltage_Phase_1_2" />
			<result property="Voltage_Phase_2_3" column="Voltage_Phase_2_3" />
			<result property="Voltage_Phase_3_1" column="Voltage_Phase_3_1" />
			<result property="Residual_DC_Current" column="Residual_DC_Current" />
			<result property="Insulation_Resistance" column="Insulation_Resistance" />
			<result property="Feed_In_Time" column="Feed_In_Time" />
			<result property="Operating_Time" column="Operating_Time" />
			<result property="Total_Yield" column="Total_Yield" />
			<result property="Internal_Temperature" column="Internal_Temperature" />
			<result property="DC_Current_Input_1" column="DC_Current_Input_1" />
			<result property="DC_Current_Input_2" column="DC_Current_Input_2" />
			<result property="DC_Current_Input_3" column="DC_Current_Input_3" />
			<result property="DC_Current_Input_4" column="DC_Current_Input_4" />			
			<result property="DC_Voltage_Input_1" column="DC_Voltage_Input_1" />
			<result property="DC_Voltage_Input_2" column="DC_Voltage_Input_2" />
			<result property="DC_Voltage_Input_3" column="DC_Voltage_Input_3" />
			<result property="DC_Voltage_Input_4" column="DC_Voltage_Input_4" />
			<result property="DC_Power_Input_1" column="DC_Power_Input_1" />
			<result property="DC_Power_Input_2" column="DC_Power_Input_2" />
			<result property="DC_Power_Input_3" column="DC_Power_Input_3" />
			<result property="DC_Power_Input_4" column="DC_Power_Input_4" />
			
		    <result property="nvmActivePower" column="nvmActivePower" />
		    <result property="nvmActiveEnergy" column="nvmActiveEnergy" />
		    <result property="MeasuredProduction" column="MeasuredProduction" />
		    <result property="datatablename" column="datatablename" />
			<result property="view_tablename" column="view_tablename" />
			<result property="job_tablename" column="job_tablename" />
	</resultMap>

	<insert id="insertModelSmaStp2550us50" useGeneratedKeys="true" keyProperty="time">
		INSERT INTO `${datatablename}`
		<trim prefix="(" suffix=")" suffixOverrides="," >
			<if test="time != null" >
	        	`time`,
	        </if>
			<if test="id_device != 0.001" >
	            `id_device`,
	        </if>
			<if test="error != 0.001" >
	            `error`,
	        </if>
			<if test="low_alarm != 0.001" >
	            `low_alarm`,
	        </if>
			<if test="high_alarm != 0.001" >
	            `high_alarm`,
	        </if>
			<if test="Grid_Frequency != 0.001" >
				`Grid_Frequency`,
			</if>
			<if test="Apparent_Power != 0.001" >
				`Apparent_Power`,
			</if>
			<if test="Reactive_Power != 0.001" >
				`Reactive_Power`,
			</if>
			<if test="Active_Power != 0.001" >
				`Active_Power`,
			</if>
			<if test="Power_Factor != 0.001" >
				`Power_Factor`,
			</if>
			<if test="Grid_Current != 0.001" >
				`Grid_Current`,
			</if>
			<if test="Current_Phase_1 != 0.001" >
				`Current_Phase_1`,
			</if>
			<if test="Current_Phase_2 != 0.001" >
				`Current_Phase_2`,
			</if>
			<if test="Current_Phase_3 != 0.001" >
				`Current_Phase_3`,
			</if>
			<if test="Active_Power_Phase_1 != 0.001" >
				`Active_Power_Phase_1`,
			</if>
			<if test="Active_Power_Phase_2 != 0.001" >
				`Active_Power_Phase_2`,
			</if>
			<if test="Active_Power_Phase_3 != 0.001" >
				`Active_Power_Phase_3`,
			</if>
			<if test="Reactive_Power_Phase_1 != 0.001" >
				`Reactive_Power_Phase_1`,
			</if>
			<if test="Reactive_Power_Phase_2 != 0.001" >
				`Reactive_Power_Phase_2`,
			</if>
			<if test="Reactive_Power_Phase_3 != 0.001" >
				`Reactive_Power_Phase_3`,
			</if>
			<if test="Apparent_Power_Phase_1 != 0.001" >
				`Apparent_Power_Phase_1`,
			</if>
			<if test="Apparent_Power_Phase_2 != 0.001" >
				`Apparent_Power_Phase_2`,
			</if>
			<if test="Apparent_Power_Phase_3 != 0.001" >
				`Apparent_Power_Phase_3`,
			</if>
			<if test="Voltage_Phase_1 != 0.001" >
				`Voltage_Phase_1`,
			</if>
			<if test="Voltage_Phase_2 != 0.001" >
				`Voltage_Phase_2`,
			</if>
			<if test="Voltage_Phase_3 != 0.001" >
				`Voltage_Phase_3`,
			</if>
			<if test="Voltage_Phase_1_2 != 0.001" >
				`Voltage_Phase_1_2`,
			</if>
			<if test="Voltage_Phase_2_3 != 0.001" >
				`Voltage_Phase_2_3`,
			</if>
			<if test="Voltage_Phase_3_1 != 0.001" >
				`Voltage_Phase_3_1`,
			</if>
			<if test="Residual_DC_Current != 0.001" >
				`Residual_DC_Current`,
			</if>
			<if test="Insulation_Resistance != 0.001" >
				`Insulation_Resistance`,
			</if>
			<if test="Feed_In_Time != 0.001" >
				`Feed_In_Time`,
			</if>
			<if test="Operating_Time != 0.001" >
				`Operating_Time`,
			</if>
			<if test="Total_Yield != 0.001" >
				`Total_Yield`,
			</if>
			<if test="Internal_Temperature != 0.001" >
				`Internal_Temperature`,
			</if>
			<if test="DC_Current_Input_1 != 0.001" >
				`DC_Current_Input_1`,
			</if>
			<if test="DC_Current_Input_2 != 0.001" >
				`DC_Current_Input_2`,
			</if>
			<if test="DC_Current_Input_3 != 0.001" >
				`DC_Current_Input_3`,
			</if>
			<if test="DC_Current_Input_4 != 0.001" >
				`DC_Current_Input_4`,
			</if>			
			<if test="DC_Voltage_Input_1 != 0.001" >
				`DC_Voltage_Input_1`,
			</if>
			<if test="DC_Voltage_Input_2 != 0.001" >
				`DC_Voltage_Input_2`,
			</if>
			<if test="DC_Voltage_Input_3 != 0.001" >
				`DC_Voltage_Input_3`,
			</if>
			<if test="DC_Voltage_Input_4 != 0.001" >
				`DC_Voltage_Input_4`,
			</if>
			<if test="DC_Power_Input_1 != 0.001" >
				`DC_Power_Input_1`,
			</if>
			<if test="DC_Power_Input_2 != 0.001" >
				`DC_Power_Input_2`,
			</if>
			<if test="DC_Power_Input_3 != 0.001" >
				`DC_Power_Input_3`,
			</if>
			<if test="DC_Power_Input_4 != 0.001" >
				`DC_Power_Input_4`,
			</if>	
			<if test="nvmActivePower != 0.001" >
			  	`nvmActivePower`,
			</if>
			<if test="nvmActiveEnergy != 0.001" >
			  	`nvmActiveEnergy`,
			</if>
			<if test="MeasuredProduction != 0.001">
				`MeasuredProduction`,
			</if>
		</trim>
		
		<trim prefix="values (" suffix=")" suffixOverrides="," >
			<if test="time != null" >
                #{time},
	        </if>
			<if test="id_device != 0.001" >
                #{id_device},
	        </if>
			<if test="error != 0.001" >
	        	#{error},
	        </if>
			<if test="low_alarm != 0.001" >
	            #{low_alarm},
	        </if>
			<if test="high_alarm != 0.001" >
	        	#{high_alarm},
	        </if>
			<if test="Grid_Frequency != 0.001" >
				#{Grid_Frequency},
			</if>
			<if test="Apparent_Power != 0.001" >
				#{Apparent_Power},
			</if>
			<if test="Reactive_Power != 0.001" >
				#{Reactive_Power},
			</if>
			<if test="Active_Power != 0.001" >
				#{Active_Power},
			</if>
			<if test="Power_Factor != 0.001" >
				#{Power_Factor},
			</if>
			<if test="Grid_Current != 0.001" >
				#{Grid_Current},
			</if>
			<if test="Current_Phase_1 != 0.001" >
				#{Current_Phase_1},
			</if>
			<if test="Current_Phase_2 != 0.001" >
				#{Current_Phase_2},
			</if>
			<if test="Current_Phase_3 != 0.001" >
				#{Current_Phase_3},
			</if>
			<if test="Active_Power_Phase_1 != 0.001" >
				#{Active_Power_Phase_1},
			</if>
			<if test="Active_Power_Phase_2 != 0.001" >
				#{Active_Power_Phase_2},
			</if>
			<if test="Active_Power_Phase_3 != 0.001" >
				#{Active_Power_Phase_3},
			</if>
			<if test="Reactive_Power_Phase_1 != 0.001" >
				#{Reactive_Power_Phase_1},
			</if>
			<if test="Reactive_Power_Phase_2 != 0.001" >
				#{Reactive_Power_Phase_2},
			</if>
			<if test="Reactive_Power_Phase_3 != 0.001" >
				#{Reactive_Power_Phase_3},
			</if>
			<if test="Apparent_Power_Phase_1 != 0.001" >
				#{Apparent_Power_Phase_1},
			</if>
			<if test="Apparent_Power_Phase_2 != 0.001" >
				#{Apparent_Power_Phase_2},
			</if>
			<if test="Apparent_Power_Phase_3 != 0.001" >
				#{Apparent_Power_Phase_3},
			</if>
			<if test="Voltage_Phase_1 != 0.001" >
				#{Voltage_Phase_1},
			</if>
			<if test="Voltage_Phase_2 != 0.001" >
				#{Voltage_Phase_2},
			</if>
			<if test="Voltage_Phase_3 != 0.001" >
				#{Voltage_Phase_3},
			</if>
			<if test="Voltage_Phase_1_2 != 0.001" >
				#{Voltage_Phase_1_2},
			</if>
			<if test="Voltage_Phase_2_3 != 0.001" >
				#{Voltage_Phase_2_3},
			</if>
			<if test="Voltage_Phase_3_1 != 0.001" >
				#{Voltage_Phase_3_1},
			</if>
			<if test="Residual_DC_Current != 0.001" >
				#{Residual_DC_Current},
			</if>
			<if test="Insulation_Resistance != 0.001" >
				#{Insulation_Resistance},
			</if>
			<if test="Feed_In_Time != 0.001" >
				#{Feed_In_Time},
			</if>
			<if test="Operating_Time != 0.001" >
				#{Operating_Time},
			</if>
			<if test="Total_Yield != 0.001" >
				#{Total_Yield},
			</if>
			<if test="Internal_Temperature != 0.001" >
				#{Internal_Temperature},
			</if>
			<if test="DC_Current_Input_1 != 0.001" >
				#{DC_Current_Input_1},
			</if>
			<if test="DC_Current_Input_2 != 0.001" >
				#{DC_Current_Input_2},
			</if>
			<if test="DC_Current_Input_3 != 0.001" >
				#{DC_Current_Input_3},
			</if>
			<if test="DC_Current_Input_4 != 0.001" >
				#{DC_Current_Input_4},
			</if>			
			<if test="DC_Voltage_Input_1 != 0.001" >
				#{DC_Voltage_Input_1},
			</if>
			<if test="DC_Voltage_Input_2 != 0.001" >
				#{DC_Voltage_Input_2},
			</if>
			<if test="DC_Voltage_Input_3 != 0.001" >
				#{DC_Voltage_Input_3},
			</if>
			<if test="DC_Voltage_Input_4 != 0.001" >
				#{DC_Voltage_Input_4},
			</if>
			<if test="DC_Power_Input_1 != 0.001" >
				#{DC_Power_Input_1},
			</if>
			<if test="DC_Power_Input_2 != 0.001" >
				#{DC_Power_Input_2},
			</if>
			<if test="DC_Power_Input_3 != 0.001" >
				#{DC_Power_Input_3},
			</if>
			<if test="DC_Power_Input_4 != 0.001" >
				#{DC_Power_Input_4},
			</if>		
			<if test="nvmActivePower != 0.001" >
			  	#{nvmActivePower},
			</if>
			<if test="nvmActiveEnergy != 0.001" >
			  	#{nvmActiveEnergy},
			</if>
			<if test="MeasuredProduction != 0.001">
				#{MeasuredProduction},
			</if>
		</trim>
		
		<trim prefix="ON DUPLICATE KEY UPDATE " suffix=""
			suffixOverrides=",">
			<if test="id_device != 0.001" >
	        	`id_device` = #{id_device},
	        </if>
			<if test="error != 0.001" >
	        	`error` = #{error},
	        </if>
			<if test="low_alarm != 0.001" >
	            `low_alarm` = #{low_alarm},
	        </if>
			<if test="high_alarm != 0.001" >
	            `high_alarm` = #{high_alarm},
	        </if>
			<if test="Grid_Frequency != 0.001" >
				`Grid_Frequency` = #{Grid_Frequency},
			</if>
			<if test="Apparent_Power != 0.001" >
				`Apparent_Power` = #{Apparent_Power},
			</if>
			<if test="Reactive_Power != 0.001" >
				`Reactive_Power` = #{Reactive_Power},
			</if>
			<if test="Active_Power != 0.001" >
				`Active_Power` = #{Active_Power},
			</if>
			<if test="Power_Factor != 0.001" >
				`Power_Factor` = #{Power_Factor},
			</if>
			<if test="Grid_Current != 0.001" >
				`Grid_Current` = #{Grid_Current},
			</if>
			<if test="Current_Phase_1 != 0.001" >
				`Current_Phase_1` = #{Current_Phase_1},
			</if>
			<if test="Current_Phase_2 != 0.001" >
				`Current_Phase_2` = #{Current_Phase_2},
			</if>
			<if test="Current_Phase_3 != 0.001" >
				`Current_Phase_3` = #{Current_Phase_3},
			</if>
			<if test="Active_Power_Phase_1 != 0.001" >
				`Active_Power_Phase_1` = #{Active_Power_Phase_1},
			</if>
			<if test="Active_Power_Phase_2 != 0.001" >
				`Active_Power_Phase_2` = #{Active_Power_Phase_2},
			</if>
			<if test="Active_Power_Phase_3 != 0.001" >
				`Active_Power_Phase_3` = #{Active_Power_Phase_3},
			</if>
			<if test="Reactive_Power_Phase_1 != 0.001" >
				`Reactive_Power_Phase_1` = #{Reactive_Power_Phase_1},
			</if>
			<if test="Reactive_Power_Phase_2 != 0.001" >
				`Reactive_Power_Phase_2` = #{Reactive_Power_Phase_2},
			</if>
			<if test="Reactive_Power_Phase_3 != 0.001" >
				`Reactive_Power_Phase_3` = #{Reactive_Power_Phase_3},
			</if>
			<if test="Apparent_Power_Phase_1 != 0.001" >
				`Apparent_Power_Phase_1` = #{Apparent_Power_Phase_1},
			</if>
			<if test="Apparent_Power_Phase_2 != 0.001" >
				`Apparent_Power_Phase_2` = #{Apparent_Power_Phase_2},
			</if>
			<if test="Apparent_Power_Phase_3 != 0.001" >
				`Apparent_Power_Phase_3` = #{Apparent_Power_Phase_3},
			</if>
			<if test="Voltage_Phase_1 != 0.001" >
				`Voltage_Phase_1` = #{Voltage_Phase_1},
			</if>
			<if test="Voltage_Phase_2 != 0.001" >
				`Voltage_Phase_2` = #{Voltage_Phase_2},
			</if>
			<if test="Voltage_Phase_3 != 0.001" >
				`Voltage_Phase_3` = #{Voltage_Phase_3},
			</if>
			<if test="Voltage_Phase_1_2 != 0.001" >
				`Voltage_Phase_1_2` = #{Voltage_Phase_1_2},
			</if>
			<if test="Voltage_Phase_2_3 != 0.001" >
				`Voltage_Phase_2_3` = #{Voltage_Phase_2_3},
			</if>
			<if test="Voltage_Phase_3_1 != 0.001" >
				`Voltage_Phase_3_1` = #{Voltage_Phase_3_1},
			</if>
			<if test="Residual_DC_Current != 0.001" >
				`Residual_DC_Current` = #{Residual_DC_Current},
			</if>
			<if test="Insulation_Resistance != 0.001" >
				`Insulation_Resistance` = #{Insulation_Resistance},
			</if>
			<if test="Feed_In_Time != 0.001" >
				`Feed_In_Time` = #{Feed_In_Time},
			</if>
			<if test="Operating_Time != 0.001" >
				`Operating_Time` = #{Operating_Time},
			</if>
			<if test="Total_Yield != 0.001" >
				`Total_Yield` = #{Total_Yield},
			</if>
			<if test="Internal_Temperature != 0.001" >
				`Internal_Temperature` = #{Internal_Temperature},
			</if>
			<if test="DC_Current_Input_1 != 0.001" >
				`DC_Current_Input_1` = #{DC_Current_Input_1},
			</if>
			<if test="DC_Current_Input_2 != 0.001" >
				`DC_Current_Input_2` = #{DC_Current_Input_2},
			</if>
			<if test="DC_Current_Input_3 != 0.001" >
				`DC_Current_Input_3` = #{DC_Current_Input_3},
			</if>
			<if test="DC_Current_Input_4 != 0.001" >
				`DC_Current_Input_4` = #{DC_Current_Input_4},
			</if>	
			<if test="DC_Voltage_Input_1 != 0.001" >
				`DC_Voltage_Input_1` = #{DC_Voltage_Input_1},
			</if>
			<if test="DC_Voltage_Input_2 != 0.001" >
				`DC_Voltage_Input_2` = #{DC_Voltage_Input_2},
			</if>
			<if test="DC_Voltage_Input_3 != 0.001" >
				`DC_Voltage_Input_3` = #{DC_Voltage_Input_3},
			</if>
			<if test="DC_Voltage_Input_4 != 0.001" >
				`DC_Voltage_Input_4` = #{DC_Voltage_Input_4},
			</if>
			<if test="DC_Power_Input_1 != 0.001" >
				`DC_Power_Input_1` = #{DC_Power_Input_1},
			</if>
			<if test="DC_Power_Input_2 != 0.001" >
				`DC_Power_Input_2` = #{DC_Power_Input_2},
			</if>
			<if test="DC_Power_Input_3 != 0.001" >
				`DC_Power_Input_3` = #{DC_Power_Input_3},
			</if>
			<if test="DC_Power_Input_4 != 0.001" >
				`DC_Power_Input_4` = #{DC_Power_Input_4},
			</if>		
			<if test="nvmActivePower != 0.001" >
			 	`nvmActivePower` = #{nvmActivePower},
			</if>
			<if test="nvmActiveEnergy != 0.001" >
			 	`nvmActiveEnergy` = #{nvmActiveEnergy},
			</if>
			<if test="MeasuredProduction != 0.001 and MeasuredProduction > 0">
				`MeasuredProduction` = #{MeasuredProduction},
			</if>
		</trim>
	</insert>
	
	<select id="getLastRow" resultType="com.nwm.api.entities.ModelSmaStp2550us50Entity">
		SELECT
			dv.*,
			s.enable_alert
		FROM
			${view_tablename} dv 
			LEFT JOIN device d ON d.id = dv.id_device
			LEFT JOIN site s ON s.id = d.id_site
		WHERE
			dv.id_device = #{id_device}
			<if test="time != null" >
	        	AND dv.time <![CDATA[<]]> #{time}
	        </if>
		ORDER BY
			dv.time DESC 
			LIMIT 1
	</select>
</mapper> 