<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="ModelAbbTrio500tkOutd">
  	
  	
  	<insert id="insertModelAbbTrio500tkOutd" useGeneratedKeys="true"
		keyProperty="time">
		INSERT INTO `${datatablename}`
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="time != null">
				`time`,
			</if>
			<if test="id_device != 0.001">
				`id_device`,
			</if>
			<if test="error != 0.001">
				`error`,
			</if>
			<if test="low_alarm != 0.001">
				`low_alarm`,
			</if>
			<if test="high_alarm != 0.001">
				`high_alarm`,
			</if>
			
			<if test="RemoteOnOff != 0.001">
			`RemoteOnOff`,
			</if>
			<if test="ResetbyHand != 0.001">
			  `ResetbyHand`,
			  </if>
			<if test="DynamicModePowerFactorSetPoint != 0.001">
			  `DynamicModePowerFactorSetPoint`,
			  </if>

			<if test="PermanentModePowerFactorSetPoint != 0.001">
			  `PermanentModePowerFactorSetPoint`,
			  </if>
			<if test="DynamicModeActivePowerSetPoint != 0.001">
			  `DynamicModeActivePowerSetPoint`,
			  </if>
			<if test="PermanentModeActivePowerSetPoint != 0.001">
			  `PermanentModeActivePowerSetPoint`,
			  </if>
			<if test="InverterGridReactivePower != 0.001">
			  `InverterGridReactivePower`,
			  </if>
			<if test="InverterGridVoltage != 0.001">
			  `InverterGridVoltage`,
			  </if>
			<if test="InverterGridCurrent != 0.001">
			  `InverterGridCurrent`,
			  </if>
			<if test="GlobalState != 0.001">
			  `GlobalState`,
			  </if>
			<if test="AlarmState != 0.001">
			  `AlarmState`,
			  </if>
			<if test="DCDCConverterState != 0.001">
			  `DCDCConverterState`,
			  </if>
			<if test="DCACConverterState != 0.001">
			  `DCACConverterState`,
			  </if>
			<if test="DailyEnergy != 0.001">
			  `DailyEnergy`,
			  </if>
			<if test="TotalEnergy != 0.001">
			  `TotalEnergy`,
			  </if>
			<if test="WeeklyEnergy != 0.001">
			  `WeeklyEnergy`,
			  </if>
			<if test="MonthlyEnergy != 0.001">
			  `MonthlyEnergy`,
			  </if>
			<if test="YearlyEnergy != 0.001">
			  `YearlyEnergy`,
			  </if>
			<if test="MeanGridVoltage != 0.001">
			  `MeanGridVoltage`,
			  </if>
			<if test="MeanOutputCurrent != 0.001">
			  `MeanOutputCurrent`,
			  </if>
			<if test="OutputActivePower != 0.001">
			  `OutputActivePower`,
			  </if>
			<if test="ReactivePower != 0.001">
			  `ReactivePower`,
			  </if>
			<if test="PowerFactor != 0.001">
			  `PowerFactor`,
			  </if>
			<if test="MeanGridFrequency != 0.001">
			  `MeanGridFrequency`,
			  </if>
			<if test="ActivePoweronDCInput1 != 0.001">
			  `ActivePoweronDCInput1`,
			  </if>
			<if test="VoltageonDCInput1 != 0.001">
			  `VoltageonDCInput1`,
			  </if>
			<if test="CurrentonDCInput1 != 0.001">
			  `CurrentonDCInput1`,
			  </if>
			<if test="ActivePoweronDCInput2 != 0.001">
			  `ActivePoweronDCInput2`,
			  </if>
			<if test="VoltageonDCInput2 != 0.001">
			  `VoltageonDCInput2`,
			  </if>
			<if test="CurrentonDCInput2 != 0.001">
			  `CurrentonDCInput2`,
			  </if>
			<if test="InternalTemperature != 0.001">
			  `InternalTemperature`,
			  </if>
			<if test="InverterTemperature != 0.001">
			  `InverterTemperature`,
			  </if>
			  
			  
			<if test="nvmActivePower != 0.001">
			  `nvmActivePower`,
			  </if>
			<if test="nvmActiveEnergy != 0.001">
			  `nvmActiveEnergy`,
			  </if>
			
			<if test="MeasuredProduction != 0.001">
				`MeasuredProduction`,
			</if>
			
		</trim>

		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="time != null">
				#{time},
			</if>
			<if test="id_device != 0.001">
				#{id_device},
			</if>
			<if test="error != 0.001">
				#{error},
			</if>
			<if test="low_alarm != 0.001">
				#{low_alarm},
			</if>
			<if test="high_alarm != 0.001">
				#{high_alarm},
			</if>
			
			<if test="RemoteOnOff != 0.001">
			#{RemoteOnOff},
			</if>
			<if test="ResetbyHand != 0.001">
			  #{ResetbyHand},
			  </if>
			<if test="DynamicModePowerFactorSetPoint != 0.001">
			  #{DynamicModePowerFactorSetPoint},
			  </if>

			<if test="PermanentModePowerFactorSetPoint != 0.001">
			  #{PermanentModePowerFactorSetPoint},
			  </if>
			<if test="DynamicModeActivePowerSetPoint != 0.001">
			  #{DynamicModeActivePowerSetPoint},
			  </if>
			<if test="PermanentModeActivePowerSetPoint != 0.001">
			  #{PermanentModeActivePowerSetPoint},
			  </if>
			<if test="InverterGridReactivePower != 0.001">
			  #{InverterGridReactivePower},
			  </if>
			<if test="InverterGridVoltage != 0.001">
			  #{InverterGridVoltage},
			  </if>
			<if test="InverterGridCurrent != 0.001">
			  #{InverterGridCurrent},
			  </if>
			<if test="GlobalState != 0.001">
			  #{GlobalState},
			  </if>
			<if test="AlarmState != 0.001">
			  #{AlarmState},
			  </if>
			<if test="DCDCConverterState != 0.001">
			  #{DCDCConverterState},
			  </if>
			<if test="DCACConverterState != 0.001">
			  #{DCACConverterState},
			  </if>
			<if test="DailyEnergy != 0.001">
			  #{DailyEnergy},
			  </if>
			<if test="TotalEnergy != 0.001">
			  #{TotalEnergy},
			  </if>
			<if test="WeeklyEnergy != 0.001">
			  #{WeeklyEnergy},
			  </if>
			<if test="MonthlyEnergy != 0.001">
			  #{MonthlyEnergy},
			  </if>
			<if test="YearlyEnergy != 0.001">
			  #{YearlyEnergy},
			  </if>
			<if test="MeanGridVoltage != 0.001">
			  #{MeanGridVoltage},
			  </if>
			<if test="MeanOutputCurrent != 0.001">
			  #{MeanOutputCurrent},
			  </if>
			<if test="OutputActivePower != 0.001">
			  #{OutputActivePower},
			  </if>
			<if test="ReactivePower != 0.001">
			  #{ReactivePower},
			  </if>
			<if test="PowerFactor != 0.001">
			  #{PowerFactor},
			  </if>
			<if test="MeanGridFrequency != 0.001">
			  #{MeanGridFrequency},
			  </if>
			<if test="ActivePoweronDCInput1 != 0.001">
			  #{ActivePoweronDCInput1},
			  </if>
			<if test="VoltageonDCInput1 != 0.001">
			  #{VoltageonDCInput1},
			  </if>
			<if test="CurrentonDCInput1 != 0.001">
			  #{CurrentonDCInput1},
			  </if>
			<if test="ActivePoweronDCInput2 != 0.001">
			  #{ActivePoweronDCInput2},
			  </if>
			<if test="VoltageonDCInput2 != 0.001">
			  #{VoltageonDCInput2},
			  </if>
			<if test="CurrentonDCInput2 != 0.001">
			  #{CurrentonDCInput2},
			  </if>
			<if test="InternalTemperature != 0.001">
			  #{InternalTemperature},
			  </if>
			<if test="InverterTemperature != 0.001">
			  #{InverterTemperature},
			  </if>
			  
			  
			<if test="nvmActivePower != 0.001">
			  #{nvmActivePower},
			  </if>
			<if test="nvmActiveEnergy != 0.001">
			  #{nvmActiveEnergy},
			  </if>
			
			<if test="MeasuredProduction != 0.001">
				#{MeasuredProduction},
			</if>
			
			
		</trim>
		
		
		<trim prefix="ON DUPLICATE KEY UPDATE " suffix="" suffixOverrides=",">
			<if test="id_device != 0.001">
				`id_device` = #{id_device},
			</if>
			<if test="error != 0.001">
				`error` = #{error},
			</if>
			<if test="low_alarm != 0.001">
				`low_alarm` = #{low_alarm},
			</if>
			<if test="high_alarm != 0.001">
				`high_alarm` = #{high_alarm},
			</if>
			
			<if test="RemoteOnOff != 0.001">
			`RemoteOnOff` = #{RemoteOnOff},
			</if>
			<if test="ResetbyHand != 0.001">
			  `ResetbyHand` = #{ResetbyHand},
			  </if>
			<if test="DynamicModePowerFactorSetPoint != 0.001">
			  `DynamicModePowerFactorSetPoint` = #{DynamicModePowerFactorSetPoint},
			  </if>

			<if test="PermanentModePowerFactorSetPoint != 0.001">
			  `PermanentModePowerFactorSetPoint` = #{PermanentModePowerFactorSetPoint},
			  </if>
			<if test="DynamicModeActivePowerSetPoint != 0.001">
			  `DynamicModeActivePowerSetPoint` = #{DynamicModeActivePowerSetPoint},
			  </if>
			<if test="PermanentModeActivePowerSetPoint != 0.001">
			  `PermanentModeActivePowerSetPoint` = #{PermanentModeActivePowerSetPoint},
			  </if>
			<if test="InverterGridReactivePower != 0.001">
			  `InverterGridReactivePower` = #{InverterGridReactivePower},
			  </if>
			<if test="InverterGridVoltage != 0.001">
			  `InverterGridVoltage` = #{InverterGridVoltage},
			  </if>
			<if test="InverterGridCurrent != 0.001">
			  `InverterGridCurrent` = #{InverterGridCurrent},
			  </if>
			<if test="GlobalState != 0.001">
			  `GlobalState` = #{GlobalState},
			  </if>
			<if test="AlarmState != 0.001">
			  `AlarmState` = #{AlarmState},
			  </if>
			<if test="DCDCConverterState != 0.001">
			  `DCDCConverterState` = #{DCDCConverterState},
			  </if>
			<if test="DCACConverterState != 0.001">
			  `DCACConverterState` = #{DCACConverterState},
			  </if>
			<if test="DailyEnergy != 0.001">
			  `DailyEnergy` = #{DailyEnergy},
			  </if>
			<if test="TotalEnergy != 0.001">
			  `TotalEnergy` = #{TotalEnergy},
			  </if>
			<if test="WeeklyEnergy != 0.001">
			  `WeeklyEnergy` = #{WeeklyEnergy},
			  </if>
			<if test="MonthlyEnergy != 0.001">
			  `MonthlyEnergy` = #{MonthlyEnergy},
			  </if>
			<if test="YearlyEnergy != 0.001">
			  `YearlyEnergy` = #{YearlyEnergy},
			  </if>
			<if test="MeanGridVoltage != 0.001">
			  `MeanGridVoltage` = #{MeanGridVoltage},
			  </if>
			<if test="MeanOutputCurrent != 0.001">
			  `MeanOutputCurrent` = #{MeanOutputCurrent},
			  </if>
			<if test="OutputActivePower != 0.001">
			  `OutputActivePower` = #{OutputActivePower},
			  </if>
			<if test="ReactivePower != 0.001">
			  `ReactivePower` = #{ReactivePower},
			  </if>
			<if test="PowerFactor != 0.001">
			  `PowerFactor` = #{PowerFactor},
			  </if>
			<if test="MeanGridFrequency != 0.001">
			  `MeanGridFrequency` = #{MeanGridFrequency},
			  </if>
			<if test="ActivePoweronDCInput1 != 0.001">
			  `ActivePoweronDCInput1` = #{ActivePoweronDCInput1},
			  </if>
			<if test="VoltageonDCInput1 != 0.001">
			  `VoltageonDCInput1` = #{VoltageonDCInput1},
			  </if>
			<if test="CurrentonDCInput1 != 0.001">
			  `CurrentonDCInput1` = #{CurrentonDCInput1},
			  </if>
			<if test="ActivePoweronDCInput2 != 0.001">
			  `ActivePoweronDCInput2` = #{ActivePoweronDCInput2},
			  </if>
			<if test="VoltageonDCInput2 != 0.001">
			  `VoltageonDCInput2` = #{VoltageonDCInput2},
			  </if>
			<if test="CurrentonDCInput2 != 0.001">
			  `CurrentonDCInput2` = #{CurrentonDCInput2},
			  </if>
			<if test="InternalTemperature != 0.001">
			  `InternalTemperature` = #{InternalTemperature},
			  </if>
			<if test="InverterTemperature != 0.001">
			  `InverterTemperature` = #{InverterTemperature},
			  </if>
			  
			  
			  
			<if test="nvmActivePower != 0.001">
			  `nvmActivePower` = ROUND(#{nvmActivePower}, 2),
			  </if>
			<if test="nvmActiveEnergy != 0.001">
			  `nvmActiveEnergy` = ROUND(#{nvmActiveEnergy}, 2),
			  
			  </if>
			  <if test="MeasuredProduction != 0.001 and MeasuredProduction > 0">
				`MeasuredProduction` = #{MeasuredProduction},
			</if>
			
			
			
		</trim>
		
		
		
	</insert>
	
	
	<select id="getLastRow" resultType="com.nwm.api.entities.ModelAbbTrio500tkOutdEntity">
		SELECT
			dv.*,
			s.enable_alert
		FROM
			${view_tablename} dv 
			LEFT JOIN device d ON d.id = dv.id_device
			LEFT JOIN site s ON s.id = d.id_site
		WHERE
			dv.id_device = #{id_device}
			<if test="time != null" >
	        	AND dv.time <![CDATA[<]]> #{time}
	        </if>
		ORDER BY
			dv.time DESC 
			LIMIT 1
  	</select>
  	
  </mapper> 