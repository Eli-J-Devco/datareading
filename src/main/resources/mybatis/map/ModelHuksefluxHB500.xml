<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ModelHuksefluxHB500">

	<insert id="insertModelHuksefluxHB500" useGeneratedKeys="true" keyProperty="time">
		INSERT INTO `${datatablename}`
		<trim prefix="(" suffix=")" suffixOverrides="," >
			<if test="time != null" >
				`time`,
			</if>
			<if test="id_device != 0.001" >
				`id_device`,
			</if>
			<if test="error != 0.001" >
				`error`,
			</if>
			<if test="low_alarm != 0.001" >
				`low_alarm`,
			</if>
			<if test="high_alarm != 0.001" >
				`high_alarm`,
			</if>
			
			<if test="ghi != 0.001" >
				`ghi`,
			</if>
			<if test="poa != 0.001" >
				`poa`,
			</if>
			<if test="rear_poa != 0.001" >
				`rear_poa`,
			</if>
			<if test="AmbientTemperature != 0.001" >
				`AmbientTemperature`,
			</if>
			<if test="Humidity != 0.001" >
				`Humidity`,
			</if>
			<if test="WindSpeed != 0.001" >
				`WindSpeed`,
			</if>
			<if test="boom != 0.001" >
				`boom`,
			</if>
			<if test="Irradiance1 != 0.001" >
				`Irradiance1`,
			</if>
			<if test="Irradiance2 != 0.001" >
				`Irradiance2`,
			</if>
			<if test="Albedo != 0.001" >
				`Albedo`,
			</if>
			<if test="AlbedoIndex != 0.001" >
				`AlbedoIndex`,
			</if>
			<if test="minute != 0.001" >
				`minute`,
			</if>
			<if test="hour != 0.001" >
				`hour`,
			</if>
			<if test="day != 0.001" >
				`day`,
			</if>
			<if test="accumulation != 0.001" >
				`accumulation`,
			</if>
			<if test="gri != 0.001" >
				`gri`,
			</if>
			<if test="nvm_irradiance != 0.001">
				`nvm_irradiance`,
			</if>
			<if test="nvm_temperature != 0.001">
				`nvm_temperature`,
			</if>
			<if test="nvm_panel_temperature != 0.001">
				`nvm_panel_temperature`,
			</if>
		</trim>
		
		<trim prefix="values (" suffix=")" suffixOverrides="," >
			<if test="time != null" >
				#{time},
			</if>
			<if test="id_device != 0.001" >
				#{id_device},
			</if>
			<if test="error != 0.001" >
				#{error},
			</if>
			<if test="low_alarm != 0.001" >
				#{low_alarm},
			</if>
			<if test="high_alarm != 0.001" >
				#{high_alarm},
			</if>
			
			<if test="ghi != 0.001" >
				#{ghi},
			</if>
			<if test="poa != 0.001" >
				#{poa},
			</if>
			<if test="rear_poa != 0.001" >
				#{rear_poa},
			</if>
			<if test="AmbientTemperature != 0.001" >
				#{AmbientTemperature},
			</if>
			<if test="Humidity != 0.001" >
				#{Humidity},
			</if>
			<if test="WindSpeed != 0.001" >
				#{WindSpeed},
			</if>
			<if test="boom != 0.001" >
				#{boom},
			</if>
			<if test="Irradiance1 != 0.001" >
				#{Irradiance1},
			</if>
			<if test="Irradiance2 != 0.001" >
				#{Irradiance2},
			</if>
			<if test="Albedo != 0.001" >
				#{Albedo},
			</if>
			<if test="AlbedoIndex != 0.001" >
				#{AlbedoIndex},
			</if>
			<if test="minute != 0.001" >
				#{minute},
			</if>
			<if test="hour != 0.001" >
				#{hour},
			</if>
			<if test="day != 0.001" >
				#{day},
			</if>
			<if test="accumulation != 0.001" >
				#{accumulation},
			</if>
			<if test="gri != 0.001" >
				#{gri},
			</if>
			<if test="nvm_irradiance != 0.001">
				#{nvm_irradiance},
			</if>
			<if test="nvm_temperature != 0.001">
				#{nvm_temperature},
			</if>
			<if test="nvm_panel_temperature != 0.001">
				#{nvm_panel_temperature},
			</if>
		</trim>
		
		<trim prefix="ON DUPLICATE KEY UPDATE " suffix="" suffixOverrides=",">
			<if test="id_device != 0.001" >
				id_device = #{id_device},
			</if>
			<if test="error != 0.001" >
				`error` = #{error},
			</if>
			<if test="low_alarm != 0.001" >
				low_alarm = #{low_alarm},
			</if>
			<if test="high_alarm != 0.001" >
				high_alarm = #{high_alarm},
			</if>
			
			<if test="ghi != 0.001" >
				`ghi` = #{ghi},
			</if>
			<if test="poa != 0.001" >
				`poa` = #{poa},
			</if>
			<if test="rear_poa != 0.001" >
				`rear_poa` = #{rear_poa},
			</if>
			<if test="AmbientTemperature != 0.001" >
				`AmbientTemperature` = #{AmbientTemperature},
			</if>
			<if test="Humidity != 0.001" >
				`Humidity` = #{Humidity},
			</if>
			<if test="WindSpeed != 0.001" >
				`WindSpeed` = #{WindSpeed},
			</if>
			<if test="boom != 0.001" >
				`boom` = #{boom},
			</if>
			<if test="Irradiance1 != 0.001" >
				`Irradiance1` = #{Irradiance1},
			</if>
			<if test="Irradiance2 != 0.001" >
				`Irradiance2` = #{Irradiance2},
			</if>
			<if test="Albedo != 0.001" >
				`Albedo` = #{Albedo},
			</if>
			<if test="AlbedoIndex != 0.001" >
				`AlbedoIndex` = #{AlbedoIndex},
			</if>
			<if test="minute != 0.001" >
				`minute` = #{minute},
			</if>
			<if test="hour != 0.001" >
				`hour` = #{hour},
			</if>
			<if test="day != 0.001" >
				`day` = #{day},
			</if>
			<if test="accumulation != 0.001" >
				`accumulation` = #{accumulation},
			</if>
			<if test="gri != 0.001" >
				`gri` = #{gri},
			</if>
			<if test="nvm_irradiance != 0.001">
				`nvm_irradiance` = #{nvm_irradiance},
			</if>
			<if test="nvm_temperature != 0.001">
				`nvm_temperature` = #{nvm_temperature},
			</if>
			<if test="nvm_panel_temperature != 0.001">
				`nvm_panel_temperature` = #{nvm_panel_temperature},
			</if>
		</trim>
	</insert>
	
	<select id="getLastRow" resultType="com.nwm.api.entities.ModelHuksefluxHB500Entity">
		SELECT
			dv.*,
			s.enable_alert
		FROM
			${view_tablename} dv 
			LEFT JOIN device d ON d.id = dv.id_device
			LEFT JOIN site s ON s.id = d.id_site
		WHERE
			dv.id_device = #{id_device}
			<if test="time != null" >
	        	AND dv.time <![CDATA[<]]> #{time}
	        </if>
		ORDER BY
			dv.time DESC 
			LIMIT 1
	</select>
	
</mapper> 