<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AccountStatus">

	<select id="getListByEmployee" resultType="com.nwm.api.entities.AccountStatusEntity" parameterType="com.nwm.api.entities.AccountStatusEntity" >
		SELECT
			CONVERT_TZ(last_login, offset_timezone, 'UTC') AS last_login,
			page_login
		FROM
			account_status
		WHERE
			id_employee = #{id_employee}
		ORDER BY
	        <choose>  
	        	<when test="sort_column != null and sort_column != ''">
	                ${sort_column} ${order_by}
	            </when>
	            
	            <otherwise>
		            id DESC
			    </otherwise>                                                  
	        </choose>
		LIMIT ${limit} OFFSET ${offset}
	</select>
	
	<select id="getLatestRecordsByEmployee" resultType="com.nwm.api.entities.AccountStatusEntity" parameterType="com.nwm.api.entities.AccountStatusEntity" >
		SELECT *
		FROM account_status
		WHERE id_employee = #{id_employee}
		ORDER BY id DESC
		LIMIT 1
	</select>
	
	<select id="getListCount" resultType="int" parameterType="com.nwm.api.entities.AccountStatusEntity">
    	SELECT count(*) as totalRecord
		FROM account_status
		WHERE id_employee = #{id_employee}
  	</select>
  	
  	<insert id="insert" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO `account_status`(
			`id_employee`,
			`last_login`,
			`offset_timezone`,
			`page_login`
		)VALUES(
			#{id_employee},
			UTC_TIMESTAMP(),
			'UTC',
			#{page_login}
		);
	</insert>
	
	<update id="update">
		UPDATE account_status
		SET
			last_login = UTC_TIMESTAMP(),
			offset_timezone = 'UTC'
		WHERE
			id = #{id}
	</update>
	
</mapper>